import { invoke } from "@tauri-apps/api/core";
import type { ParentCollection, Question, QuestionsCollection, Reason } from "./routes/typescript/types";

async function createParentCollection(title: string) {
    await invoke("create_parent_collection", { title })                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
}

async function createNestedParentCollection(title: string, parentId: number) {
    await invoke("insert_nested_parent_collection", { title, parentId })                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
}

async function getAllParentCollections(unnested?: boolean): Promise<ParentCollection[]> {
    if(unnested) {
        return await invoke("get_all_unnested_parents");
    } else {
        return await invoke("get_all_parent_collections");
    }
}

async function getCollectionsByParentId(id: number): Promise<QuestionsCollection[]> {
    return await invoke("get_collections_by_parent_id", { parId: id })                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
}

async function getParentCollectionById(id: number): Promise<ParentCollection> {
    return await invoke("get_parent_collection_by_id", { pId: id  })                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
}

async function createCollection(title: string, parentId: number): Promise<QuestionsCollection> {
    return await invoke("create_collection", { title, parentCollectionId: parentId });
}

async function getCollectionTitles(): Promise<{ id: number, title: string }[]> {
     return await invoke("get_collections_titles");
}

async function getCollectionById(id: number): Promise<QuestionsCollection> {
    return await invoke("get_collection_by_id", { colId: id })
}


async function insertQuestionByCollectionId(questionNumber: number, id: number): Promise<Question> {
    return await invoke("insert_question_by_collection_id", { questionNumber, collectionId: id });
}

async function getQuestionsByCollectionId(id: number): Promise<Question[]> {
     return await invoke("get_questions_by_collection_id", { colId: id });
}

async function getQuestionByQuestionNumber(id: number, questionNumber: number): Promise<Question> {
     return await invoke("get_question_by_question_number", { colId: id, questionNumber});
}

async function insertReason(label: string, color: string): Promise<string> {
    return await invoke("insert_reason", { label, color })
}

async function getAllReasons(): Promise<Reason[]> {
    return await invoke("get_reasons")
}

async function insertQuestionReason(questionId: number, reasonId: number) {
    return await invoke("insert_question_reason", { questionId, reasonId })
}

async function getQuestionReasonsById(questionId: number): Promise<string[]> {
    return await invoke("get_question_reasons_by_id", { questionId })
}

export { 
    createCollection, 
    createParentCollection,
    insertQuestionReason,
    insertQuestionByCollectionId,
    insertReason,
    createNestedParentCollection,
    getCollectionById,
    getCollectionTitles, 
    getQuestionsByCollectionId, 
    getQuestionByQuestionNumber, 
    getAllParentCollections,
    getParentCollectionById,
    getCollectionsByParentId,
    getAllReasons,
    getQuestionReasonsById,
}; 
